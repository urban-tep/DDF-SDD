.. _design_uc03 :

Develop and deploy a new service and/or new product
===================================================

This scenario aims at using TEP Urban for user development and integration of a new service within the platform to expose it as a processing service available in the thematic applications for its community or other users of the platform.

Data discorvery and selection have already described in the previous section :ref:`design_uc01`.


Development environment instantation
------------------------------------

When a user wants to develop and integrate a new service, the development environment proposed in Urban TEP is the Sandbox.

The next figure describes the sequence of operations for an expert user to provision the Sandbox.


.. todo:: 

  **BC** and **IT4I** please review the text with the name and the ref of the devel env. I called it Sandbox for the moment


.. uml::
  :caption: Sandbox instantation sequence diagram
  :align: center


  actor "User" as U
  participant "Portal" as P
  database "Portal Database" as PDB
  participant "IT4I" as CC
  entity "IaaS" as I
  participant "Sandbox" as SB
  
  autonumber
  
  U -> P : Request Developer Cloud Sandbox
  activate P
  P -> U : redirect user to developer info page
  U -> CC : instantiate Sandbox
  activate CC
  CC -> I : provision VM
  activate I
  I -> SB : start SB
  activate SB #DarkSalmon
  SB -> SB : contextualize VM to Sandbox
  SB -> I : SB ready
  I -> CC : SB ready
  deactivate I
  CC --> U : SB access information
  
    
.. todo:: *IT4I* complete sequence diagram and description of the sandbox provisioning


Developing and integrating a new processing service
---------------------------------------------------

4)  TEP Urban platform team checks, ingests and deploys new software and new data.
    
.. todo:: *BC* sequence diagram and description of the deployment of the new software and data

.. uml::
  :caption: Deployment of new software
  :align: center
  
  actor "User"
  participant "Sandbox"
  participant "Validator"
  participant "Procesing Center" as PC
  
  User -> Sandbox : send upload request
  activate Sandbox
  Sandbox -> Validator : optionally request feedback
  activate Validator
  Validator -> Sandbox : validation successful
  deactivate Validator
  Sandbox -> Sandbox : package the software
  activate Sandbox #Green
  deactivate Sandbox
  Sandbox -> PC : upload the packaged software
  activate PC
  PC -> PC : deploy the software
  PC -> Sandbox : deployment successful
  deactivate PC
  Sandbox -> User : deployment successful
  deactivate Sandbox


5)  User and TEP Urban platform team test the functionality of the application.
    
.. todo:: *BC* sequence diagram and description of the user interaction for testing the new software

.. uml::
  :caption: Testing of new software
  :align: center
  
  actor "User"
  participant "Sandbox"
  participant "Catalog"
  participant "WPS"
  participant "Procesing Center" as PC
  
  User -> Sandbox : test new software
  activate Sandbox
  Sandbox -> Catalog : search for a test dataset
  activate Catalog
  Catalog -> Sandbox : dataset information
  deactivate Catalog
  Sandbox -> WPS : test new software
  activate Sandbox #Green
  activate WPS
  WPS -> PC : send Execute request
  activate PC
  PC -> WPS : process status
  deactivate PC
  WPS -> Sandbox : process status
  deactivate WPS
  deactivate Sandbox
  deactivate Sandbox
  

Deploying a new service
-----------------------


6)  As soon as operational functionality of the application is verified, the new service and new data sets are registered in the catalogue/store.
     
.. todo:: *BC* sequence diagram and description of the application registration with ne software and data


Using the new service in the portal
-----------------------------------

After those operations, a :ref:`class_terradue_1_1_tep_1_1_thematic_application` with the new service is available to the expert user. Then according to the authorization option applied, the user may share this application with selected users or its community (user group). The Content authority manager may also validate this thematic application with the new service and decide to make it available publicly on the portal.

