.. _design_uc01 :

Query and access existing thematic content
==========================================


This use case aims at using TEP Urban for user exploration of the registered thematic data collection, visualize, share and download them.

.. _design_uc01_dds :

Data Discovery and selection
----------------------------

The first step for the user is to discover and search dataset in :ref:`class_terradue_1_1_tep_1_1_collection` within :ref:`class_terradue_1_1_tep_1_1_thematic_application`.

The following first figure depicts this step using the integrated geobrowser of the portal and the basic visualization functions.


.. uml::
  :caption: Data discovery, query, visualization and selection on portal geobrowser
  :align: center


  actor "User" as U
  participant "Portal" as P
  database "Portal database" as PDB
  database "Catalogue" as C
  participant "Feature Server" as FS
  
  autonumber
  
  U -> P : Query Thematic Application
  activate P
  P <-> PDB : Load Thematic Applications items
  PDB -> P : Data Collections, Services, Maps, Features...
  P -> U : Thematic Application
  deactivate P

  U -> P : Query Collection with params (AOI, timespan, filters...)
  activate P
  P -> C : Query catalogue index of the collection
  C -> P : Datasets metadata (atom, geojson...)
  P -> FS : Get visualization features (WMS, WFS, TMS...)
  FS -> P : return features
  P -> U : Datasets information and visualization features
  deactivate P


Next figure depicts the next step that consists of selecting and saving a dataset selection. Then download or share the full selection.


.. uml::
  :caption: Data selection, download and share on portal geobrowser sequence diagram
  :align: center

  actor "User" as U
  participant "Portal" as P
  database "Portal database" as PDB
  database "Catalogue" as C
  participant "Feature Server" as FS
  participant "Data Gateway" as DG
  database "Data Provider" as DP

  U -> P : Select datasets in the basket
  U -> P : Save basket as a data package
  activate P
  P <-> PDB : Save user data package
  P -> U : Data package
  deactivate P

  U -> P : Download data package
  P -> U : redirect to DG
  U -> DG : download data package
  activate DG
  DG <-> P : query data package
  DG <-> C : query the possible locations
  DG -> DG : resolve the best locations
  DG -> U : download links (direct, metalink)
  deactivate DG

  alt Partnership policy 1 or 2

  U <-> DG : Download files

  else Partnership policy 3

  U <-> DP : Download files

  end


.. _design_uc01_puma :


Data Visualization using PUMA
-----------------------------


Next figure depicts the same use case but using PUMA for the data vizualisation and manipulation.

.. uml::
  :caption: Data discovery, query, visualization and combination on PUMA
  :align: center


  actor "User" as U
  participant "Portal" as P
  database "Portal database" as PDB
  database "PUMA" as PUMA
  
  autonumber

  U -> P : Select Data Set for the exploration in PUMA
  U -> P : Visualize chosen data set in PUMA
  activate P
  P -> PUMA : Choose data set
  P -> PUMA : Prepare the default visualization for user
  P -> U : Redirect to PUMA
  deactivate P

  activate PUMA
  PUMA -> U : Interface with chosen data set and default visualizations
  U -> PUMA : Show Additional Charts about the data
  PUMA -> U : Showing the additional charts
  U -> PUMA : Filter the data set by year
  PUMA -> U : Showing filtered data set.
  U -> PUMA : Show another layer on top of current as overlay
  PUMA -> U : Showing layer on top of current
  deactivate PUMA





